package Project_1.Q5;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import org.apache.hadoop.io.Text;
import org.apache.hadoop.io.LongWritable;
import org.apache.hadoop.mrunit.mapreduce.MapDriver;
import org.apache.hadoop.mrunit.mapreduce.MapReduceDriver;
import org.apache.hadoop.mrunit.mapreduce.ReduceDriver;
import org.junit.Before;
import org.junit.Test;

import Project_1.Q5P;


public class Q5Test {
    MapDriver<LongWritable, Text, Text, Text> mapDriver;
    ReduceDriver<Text, Text, Text, Text> reduceDriver;
    MapReduceDriver<LongWritable,Text,Text,Text,Text,Text> mapReduceDriver;
    
    @Before
    public void setUp(){
    	Q5P.MapForQ5 mapper = new Q5P.MapForQ5();
    	Q5P.ReduceForQ5 reducer = new Q5P.ReduceForQ5();
    	mapDriver = MapDriver.newMapDriver(mapper);
    	reduceDriver = ReduceDriver.newReduceDriver(reducer);
    	mapReduceDriver = MapReduceDriver.newMapReduceDriver(mapper, reducer);
    }
    
    @Test
    public void testMapper() throws IOException{
    	String REC = "\"World\",\"WLD\",\"Expected years of schooling, female\",\"SE.SCH.LIFE.FE\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"6.76556634902954\",\"6.80161952972412\",\"6.89811658859253\",\"7.08268308639526\",\"7.11384630203247\",\"7.31694936752319\",\"7.48138523101807\",\"7.65747976303101\",\"7.73807144165039\",\"7.72811365127563\",\"7.77619028091431\",\"7.8228645324707\",\"7.83025360107422\",\"7.895583152771\",\"7.95941591262817\",\"8.07304859161377\",\"8.21569538116455\",\"8.28368663787842\",\"8.39872646331787\",\"8.41702079772949\",\"8.42087173461914\",\"8.51622009277344\",\"8.60475635528564\",\"8.68434238433838\",\"8.75839614868164\",\"8.84763622283936\",\"8.93411827087402\",\"9.0656270980835\",\"9.13003349304199\",\"9.2488260269165\",\"9.39918327331543\",\"9.48408317565918\",\"9.66078758239746\",\"9.99278545379639\",\"10.1659994125366\",\"10.3900423049927\",\"10.5622329711914\",\"10.7883052825928\",\"11.0289840698242\",\"11.1802358627319\",\"11.4147691726685\",\"11.6273488998413\",\"11.8353681564331\",\"12.0664520263672\",\"12.1193771362305\",\"\",\"\",\n"+
    			"\"World\",\"WLD\",\"Expected years of schooling, male\",\"SE.SCH.LIFE.MA\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"8.62452220916748\",\"8.69116306304932\",\"8.83232498168945\",\"9.06389427185059\",\"9.09749889373779\",\"9.09049510955811\",\"9.16863059997559\",\"9.33927249908447\",\"9.39229774475098\",\"9.37972068786621\",\"9.4202938079834\",\"9.47495269775391\",\"9.48668956756592\",\"9.54258155822754\",\"9.6317892074585\",\"9.70395183563232\",\"9.76623153686523\",\"9.76563453674316\",\"9.85817718505859\",\"9.83181476593018\",\"9.79833984375\",\"9.83119010925293\",\"9.86424541473389\",\"9.91402053833008\",\"9.9260721206665\",\"9.96831035614014\",\"10.0206508636475\",\"10.0808734893799\",\"10.0803937911987\",\"10.1339254379272\",\"10.2844457626343\",\"10.3218355178833\",\"10.4827919006348\",\"10.6390914916992\",\"10.8121099472046\",\"10.9648847579956\",\"11.088077545166\",\"11.2727918624878\",\"11.4334335327148\",\"11.5072402954102\",\"11.7297086715698\",\"11.9294872283936\",\"12.07799243927\",\"12.1454000473022\",\"12.1798524856567\",\"\",\"\",\n"+
    			"\"World\",\"WLD\",\"Fertility rate, total (births per woman)\",\"SP.DYN.TFRT.IN\",\"4.98440369212028\",\"5.00804488990175\",\"5.0301495406126\",\"5.05059356493346\",\"5.06112008170091\",\"5.04468662197364\",\"4.9951632752789\",\"4.9784096903185\",\"4.92751110083247\",\"4.86059333619675\",\"4.78276078927964\",\"4.67564935099367\",\"4.54767727758465\",\"4.41930572082459\",\"4.29726993415724\",\"4.16528569942113\",\"4.04698429553545\",\"3.94380690736909\",\"3.84884970048758\",\"3.77902042787268\",\"3.71854268796403\",\"3.66058224991448\",\"3.6305939722433\",\"3.59777133106991\",\"3.56771023746435\",\"3.54174026529795\",\"3.50858774789416\",\"3.46838952168971\",\"3.41648492949498\",\"3.34880552564661\",\"3.27734018290383\",\"3.18933616427614\",\"3.10238876192091\",\"3.01325604313549\",\"2.93864624861598\",\"2.86731377249721\",\"2.80923395793941\",\"2.7572328868144\",\"2.71873208350552\",\"2.68306134245724\",\"2.66037425718796\",\"2.63203609774535\",\"2.61166732445732\",\"2.59554097129302\",\"2.58149348523727\",\"2.5614926922568\",\"2.55203900521122\",\"2.54310080036406\",\"2.53263563986767\",\"2.51453116378611\",\"2.50007124386686\",\"2.48479602312022\",\"2.4769704039349\",\"2.46326056799919\",\"2.45718677591899\",\"2.44820807650394\",\"\",\n"+
    			"\"Uganda\",\"UGA\",\"Fertility rate, total (births per woman)\",\"SP.DYN.TFRT.IN\",\"6.999\",\"7.019\",\"7.04\",\"7.06\",\"7.078\",\"7.094\",\"7.106\",\"7.113\",\"7.117\",\"7.118\",\"7.115\",\"7.111\",\"7.107\",\"7.103\",\"7.1\",\"7.099\",\"7.099\",\"7.099\",\"7.099\",\"7.1\",\"7.1\",\"7.101\",\"7.101\",\"7.102\",\"7.103\",\"7.103\",\"7.103\",\"7.102\",\"7.1\",\"7.097\",\"7.091\",\"7.082\",\"7.071\",\"7.057\",\"7.039\",\"7.018\",\"6.994\",\"6.967\",\"6.937\",\"6.903\",\"6.865\",\"6.822\",\"6.772\",\"6.716\",\"6.653\",\"6.583\",\"6.507\",\"6.424\",\"6.337\",\"6.247\",\"6.154\",\"6.059\",\"5.964\",\"5.869\",\"5.775\",\"5.682\",\"\",\n"+
    			"\"Uganda\",\"UGA\",\"Expected years of schooling, female\",\"SE.SCH.LIFE.FE\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"2.68884\",\"2.86749\",\"3.06613\",\"\",\"3.31994\",\"\",\"3.65036\",\"4.18087\",\"\",\"\",\"\",\"5.25129\",\"\",\"\",\"\",\"4.93097\",\"\",\"4.41589\",\"\",\"5.1675\",\"\",\"\",\"\",\"\",\"\",\"10.33292\",\"10.65179\",\"11.20347\",\"11.24503\",\"10.58939\",\"\",\"10.16404\",\"\",\"10.62188\",\"10.78093\",\"10.54385\",\"9.90151\",\"\",\"\",\"\",\"\",\"\",\n";
    	mapDriver.withInput(new LongWritable(), new Text(REC));
    	
    	mapDriver.withOutput(new Text("World/SP.DYN.TFRT.IN"), new Text("1996:2.80923395793941"));
    	mapDriver.withOutput(new Text("World/SP.DYN.TFRT.IN"), new Text("1995:2.86731377249721"));
    	mapDriver.withOutput(new Text("World/SP.DYN.TFRT.IN"), new Text("1994:2.93864624861598"));
    	mapDriver.withOutput(new Text("World/SP.DYN.TFRT.IN"), new Text("2015:2.44820807650394"));
    	mapDriver.withOutput(new Text("Uganda/SP.DYN.TFRT.IN"), new Text("2008:6.337"));
    	mapDriver.withOutput(new Text("Uganda/SP.DYN.TFRT.IN"), new Text("2009:6.247"));
    	mapDriver.withOutput(new Text("Uganda/SP.DYN.TFRT.IN"), new Text("2010:6.154"));
    	mapDriver.withOutput(new Text("Uganda/SE.SCH.LIFE.FE"), new Text("1992:4.41589"));
    	mapDriver.withOutput(new Text("Uganda/SE.SCH.LIFE.FE"), new Text("2009:10.78093"));
    	
    	
    }
    
    @Test
    public void testReducer() throws IOException{
    	List<Text> values1 = new ArrayList<Text>();
		values1.add(new Text("1996:2.80923395793941"));
		values1.add(new Text("1995:2.86731377249721"));
		values1.add(new Text("1994:2.93864624861598"));
		values1.add(new Text("2015:2.44820807650394"));
    	reduceDriver.withInput(new Text("World/SP.DYN.TFRT.IN"), values1);
    	
    	List<Text> values2 = new ArrayList<Text>();
		values2.add(new Text("2008:6.337"));
		values2.add(new Text("2009:6.247"));
		values2.add(new Text("2010:6.154"));
    	reduceDriver.withInput(new Text("Uganda/SP.DYN.TFRT.IN"), values2);
    	
    	List<Text> values3 = new ArrayList<Text>();
    	values3.add(new Text("1992:4.41589"));
    	values3.add(new Text("2009:10.78093"));
    	reduceDriver.withInput(new Text("Uganda/SE.SCH.LIFE.FE"), values3);
    	
    	reduceDriver.withOutput(new Text("World/SP.DYN.TFRT.IN"),new Text("1996:2.80923395793941,1995:2.86731377249721,1994:2.93864624861598,2015:2.44820807650394,"));
    	reduceDriver.withOutput(new Text("Uganda/SP.DYN.TFRT.IN"),new Text("2008:6.337,2009:6.247,2010:6.154,"));
    	reduceDriver.withOutput(new Text("Uganda/SE.SCH.LIFE.FE"), new Text("1992:4.41589,2009:10.78093,"));
    	
    	reduceDriver.run();
    }
    
    @Test
    public void testMapReducer(){
    	String REC = "\"World\",\"WLD\",\"Expected years of schooling, female\",\"SE.SCH.LIFE.FE\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"6.76556634902954\",\"6.80161952972412\",\"6.89811658859253\",\"7.08268308639526\",\"7.11384630203247\",\"7.31694936752319\",\"7.48138523101807\",\"7.65747976303101\",\"7.73807144165039\",\"7.72811365127563\",\"7.77619028091431\",\"7.8228645324707\",\"7.83025360107422\",\"7.895583152771\",\"7.95941591262817\",\"8.07304859161377\",\"8.21569538116455\",\"8.28368663787842\",\"8.39872646331787\",\"8.41702079772949\",\"8.42087173461914\",\"8.51622009277344\",\"8.60475635528564\",\"8.68434238433838\",\"8.75839614868164\",\"8.84763622283936\",\"8.93411827087402\",\"9.0656270980835\",\"9.13003349304199\",\"9.2488260269165\",\"9.39918327331543\",\"9.48408317565918\",\"9.66078758239746\",\"9.99278545379639\",\"10.1659994125366\",\"10.3900423049927\",\"10.5622329711914\",\"10.7883052825928\",\"11.0289840698242\",\"11.1802358627319\",\"11.4147691726685\",\"11.6273488998413\",\"11.8353681564331\",\"12.0664520263672\",\"12.1193771362305\",\"\",\"\",\n"+
    			"\"World\",\"WLD\",\"Expected years of schooling, male\",\"SE.SCH.LIFE.MA\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"8.62452220916748\",\"8.69116306304932\",\"8.83232498168945\",\"9.06389427185059\",\"9.09749889373779\",\"9.09049510955811\",\"9.16863059997559\",\"9.33927249908447\",\"9.39229774475098\",\"9.37972068786621\",\"9.4202938079834\",\"9.47495269775391\",\"9.48668956756592\",\"9.54258155822754\",\"9.6317892074585\",\"9.70395183563232\",\"9.76623153686523\",\"9.76563453674316\",\"9.85817718505859\",\"9.83181476593018\",\"9.79833984375\",\"9.83119010925293\",\"9.86424541473389\",\"9.91402053833008\",\"9.9260721206665\",\"9.96831035614014\",\"10.0206508636475\",\"10.0808734893799\",\"10.0803937911987\",\"10.1339254379272\",\"10.2844457626343\",\"10.3218355178833\",\"10.4827919006348\",\"10.6390914916992\",\"10.8121099472046\",\"10.9648847579956\",\"11.088077545166\",\"11.2727918624878\",\"11.4334335327148\",\"11.5072402954102\",\"11.7297086715698\",\"11.9294872283936\",\"12.07799243927\",\"12.1454000473022\",\"12.1798524856567\",\"\",\"\",\n"+
    			"\"World\",\"WLD\",\"Fertility rate, total (births per woman)\",\"SP.DYN.TFRT.IN\",\"4.98440369212028\",\"5.00804488990175\",\"5.0301495406126\",\"5.05059356493346\",\"5.06112008170091\",\"5.04468662197364\",\"4.9951632752789\",\"4.9784096903185\",\"4.92751110083247\",\"4.86059333619675\",\"4.78276078927964\",\"4.67564935099367\",\"4.54767727758465\",\"4.41930572082459\",\"4.29726993415724\",\"4.16528569942113\",\"4.04698429553545\",\"3.94380690736909\",\"3.84884970048758\",\"3.77902042787268\",\"3.71854268796403\",\"3.66058224991448\",\"3.6305939722433\",\"3.59777133106991\",\"3.56771023746435\",\"3.54174026529795\",\"3.50858774789416\",\"3.46838952168971\",\"3.41648492949498\",\"3.34880552564661\",\"3.27734018290383\",\"3.18933616427614\",\"3.10238876192091\",\"3.01325604313549\",\"2.93864624861598\",\"2.86731377249721\",\"2.80923395793941\",\"2.7572328868144\",\"2.71873208350552\",\"2.68306134245724\",\"2.66037425718796\",\"2.63203609774535\",\"2.61166732445732\",\"2.59554097129302\",\"2.58149348523727\",\"2.5614926922568\",\"2.55203900521122\",\"2.54310080036406\",\"2.53263563986767\",\"2.51453116378611\",\"2.50007124386686\",\"2.48479602312022\",\"2.4769704039349\",\"2.46326056799919\",\"2.45718677591899\",\"2.44820807650394\",\"\",\n"+
    			"\"Uganda\",\"UGA\",\"Fertility rate, total (births per woman)\",\"SP.DYN.TFRT.IN\",\"6.999\",\"7.019\",\"7.04\",\"7.06\",\"7.078\",\"7.094\",\"7.106\",\"7.113\",\"7.117\",\"7.118\",\"7.115\",\"7.111\",\"7.107\",\"7.103\",\"7.1\",\"7.099\",\"7.099\",\"7.099\",\"7.099\",\"7.1\",\"7.1\",\"7.101\",\"7.101\",\"7.102\",\"7.103\",\"7.103\",\"7.103\",\"7.102\",\"7.1\",\"7.097\",\"7.091\",\"7.082\",\"7.071\",\"7.057\",\"7.039\",\"7.018\",\"6.994\",\"6.967\",\"6.937\",\"6.903\",\"6.865\",\"6.822\",\"6.772\",\"6.716\",\"6.653\",\"6.583\",\"6.507\",\"6.424\",\"6.337\",\"6.247\",\"6.154\",\"6.059\",\"5.964\",\"5.869\",\"5.775\",\"5.682\",\"\",\n"+
    			"\"Uganda\",\"UGA\",\"Expected years of schooling, female\",\"SE.SCH.LIFE.FE\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"2.68884\",\"2.86749\",\"3.06613\",\"\",\"3.31994\",\"\",\"3.65036\",\"4.18087\",\"\",\"\",\"\",\"5.25129\",\"\",\"\",\"\",\"4.93097\",\"\",\"4.41589\",\"\",\"5.1675\",\"\",\"\",\"\",\"\",\"\",\"10.33292\",\"10.65179\",\"11.20347\",\"11.24503\",\"10.58939\",\"\",\"10.16404\",\"\",\"10.62188\",\"10.78093\",\"10.54385\",\"9.90151\",\"\",\"\",\"\",\"\",\"\",\n";
    	
    	mapReduceDriver.withInput(new LongWritable(), new Text(REC));
    	
    	mapReduceDriver.withOutput(new Text("World/SP.DYN.TFRT.IN"),new Text("1995:2.86731377249721,1994:2.93864624861598,1993:3.01325604313549,1992:3.10238876192091,1991:3.18933616427614,1990:3.27734018290383,1989:3.34880552564661,1988:3.41648492949498,1987:3.46838952168971,2015:2.44820807650394,2014:2.45718677591899,2013:2.46326056799919,2012:2.4769704039349,2011:2.48479602312022,2010:2.50007124386686,2009:2.51453116378611,2008:2.53263563986767,2007:2.54310080036406,2006:2.55203900521122,2005:2.5614926922568,2004:2.58149348523727,2003:2.59554097129302,2002:2.61166732445732,2001:2.63203609774535,2000:2.66037425718796,1999:2.68306134245724,1998:2.71873208350552,1997:2.7572328868144,1996:2.80923395793941,"));
    	mapReduceDriver.withOutput(new Text("Uganda/SP.DYN.TFRT.IN"),new Text("1987:7.102,1988:7.1,1989:7.097,1990:7.091,1991:7.082,1992:7.071,1993:7.057,1994:7.039,1995:7.018,1996:6.994,1997:6.967,1998:6.937,1999:6.903,2000:6.865,2001:6.822,2002:6.772,2003:6.716,2004:6.653,2005:6.583,2006:6.507,2007:6.424,2008:6.337,2009:6.247,2010:6.154,2011:6.059,2012:5.964,2013:5.869,2014:5.775,2015:5.682,"));
    	mapReduceDriver.withOutput(new Text("Uganda/SE.SCH.LIFE.FE"), new Text("1990:4.93097,1992:4.41589,1994:5.1675,2000:10.33292,2001:10.65179,2002:11.20347,2003:11.24503,2004:10.58939,2006:10.16404,2008:10.62188,2009:10.78093,2010:10.54385,2011:9.90151,"));
    	
    	try {
			mapReduceDriver.run();
		} catch (IOException e) {
			e.printStackTrace();
		}
    	
    }
}
